[package]
name = "ariel-os-stm32"
version = "0.1.0"
license.workspace = true
edition.workspace = true
repository.workspace = true

[lints]
workspace = true

[dependencies]
cfg-if = { workspace = true }
defmt = { workspace = true, optional = true }
embassy-embedded-hal = { workspace = true, optional = true }
embassy-executor = { workspace = true, default-features = false, features = [
  "arch-cortex-m",
] }
embassy-stm32 = { workspace = true, default-features = false, features = [
  "memory-x",
  "optfield",
  "rt",
  "time-driver-any",
  "unstable-pac",
] }
embedded-hal-async = { workspace = true }
paste = { workspace = true }
portable-atomic = { workspace = true }
ariel-os-embassy-common = { workspace = true }
ariel-os-random = { workspace = true, optional = true }
static_cell = { workspace = true }

[target.'cfg(context = "stm32c031c6tx")'.dependencies]
embassy-stm32 = { workspace = true, features = ["stm32c031c6"] }

[target.'cfg(context = "stm32f401retx")'.dependencies]
embassy-stm32 = { workspace = true, features = ["stm32f401re"] }

[target.'cfg(context = "stm32h755zitx")'.dependencies]
embassy-stm32 = { workspace = true, features = ["stm32h755zi-cm7"] }

[target.'cfg(context = "stm32wb55rgvx")'.dependencies]
embassy-stm32 = { workspace = true, features = ["stm32wb55rg"] }

[target.'cfg(context = "stm32wba55cgux")'.dependencies]
embassy-stm32 = { workspace = true, features = ["stm32wba55cg"] }

[features]
## Enables GPIO interrupt support.
external-interrupts = [
  "embassy-stm32/exti",
  "ariel-os-embassy-common/external-interrupts",
]

## Enables seeding the random number generator from hardware.
hwrng = ["dep:ariel-os-random"]

## Enables I2C support.
# Time-related features are required for timeout support.
i2c = [
  "dep:embassy-embedded-hal",
  "ariel-os-embassy-common/i2c",
  "embassy-stm32/time",
]

## Enables SPI support.
spi = ["dep:embassy-embedded-hal", "ariel-os-embassy-common/spi"]

## Enables storage support.
storage = ["dep:embassy-embedded-hal"]

## Enables USB support.
usb = []

## Enables defmt support.
defmt = ["dep:defmt", "embassy-stm32/defmt"]

## Enables the interrupt executor.
executor-interrupt = ["embassy-executor/executor-interrupt"]

_test = ["embassy-stm32/stm32wb55rg", "external-interrupts", "i2c", "spi"]
